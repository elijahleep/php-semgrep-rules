rules:
  - id: php-ldap-injection
    languages: [php]
    mode: taint
    severity: ERROR
    message: >
      User-controlled input flows into LDAP search parameters (base DN or filter),
      which can lead to LDAP Injection. Use ldap_escape() to sanitize input.
    metadata:
      owasp: "A03:2021 â€“ Injection"
      project: "BVCS(1)"



    pattern-sources:
      - pattern: $_GET[$KEY]
      - pattern: $_POST[$KEY]
      - pattern: $_REQUEST[$KEY]
      - pattern: $_COOKIE[$KEY]
      - pattern: $REQ->query->get($P)
      - pattern: $REQ->request->get($P)
      - pattern: $REQ->get($P)


    pattern-sanitizers:
      - pattern: ldap_escape($VALUE, ...)


    pattern-sinks:
      - pattern-either:
          # ldap_search(resource, base_dn, filter, ...)
          - pattern: ldap_search($DS, $BASE, $FILTER, ...)
          - pattern: ldap_list($DS, $BASE, $FILTER, ...)
          - pattern: ldap_read($DS, $BASE, $FILTER, ...)