rules:
  - id: php-insecure-aes-ecb
    languages: [php]
    severity: ERROR
    message: |
      Insecure AES usage: ECB mode detected. ECB does not provide semantic security
      and leaks block patterns. Use CBC, GCM, or another authenticated encryption mode.

    metadata:
      owasp: "A02:2021 - Cryptographic Failures"
      project: DVWA(2)

    patterns:
      - pattern-either:
          - pattern: |
              $X = openssl_encrypt($DATA, $ALGO, $KEY, $OPTS, ...);
          - pattern: |
              $X = openssl_decrypt($DATA, $ALGO, $KEY, $OPTS, ...);
          - pattern: |
              openssl_encrypt($DATA, $ALGO, $KEY, $OPTS, ...);
          - pattern: |
              openssl_decrypt($DATA, $ALGO, $KEY, $OPTS, ...);

      - metavariable-regex:
          metavariable: $ALGO
          regex: '(?i).*aes-(128|192|256)-ecb.*'
