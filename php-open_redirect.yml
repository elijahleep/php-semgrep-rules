rules:
  - id: php-open-redirect-header
    languages: [php]
    severity: ERROR
    mode: taint
    message: |
      Possible open redirect: user-controlled data flows into a Location HTTP header.
      Validate and restrict redirect targets (e.g. allow only relative URLs or a
      fixed set of domains) before using them in redirects.
    metadata:
      owasp: "A01:2017 - Injection"
      project: DVWA(3) BVCS(1)

    pattern-sources:
      - pattern-either:
          - pattern: $_GET
          - pattern: $_POST
          - pattern: $_REQUEST
          - pattern: $_GET[$KEY]
          - pattern: $_POST[$KEY]
          - pattern: $_REQUEST[$KEY]

    pattern-sinks:
      - patterns:
          - pattern: header($HDR)
          - metavariable-regex:
              metavariable: $HDR
              regex: '(?i).*location\s*:'