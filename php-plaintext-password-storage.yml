rules:
  - id: php-plaintext-password-compare
    languages: [php]
    mode: taint
    severity: ERROR
    message: Plaintext password from HTTP request is compared directly to a database value without hashing.
    metadata:
      category: security
      subcategory: [vuln]
      owasp_top_10: "A02:2021 - Cryptographic Failures"
      project: "CodeAlpha(3|5)"

    pattern-sources:
      - pattern: $_POST[$K]
        metavariable-regex:
          metavariable: $K
          regex: '(?i)["'']?(pass(word)?|pwd|passwd)["'']?'

      - pattern: $_REQUEST[$K]
        metavariable-regex:
          metavariable: $K
          regex: '(?i)["'']?(pass(word)?|pwd|passwd)["'']?'

    pattern-sanitizers:
      - pattern: password_verify($X, ...)
        focus-metavariable: $X

    pattern-sinks:
      - pattern-either:
          - pattern: $P === $DBPW
          - pattern: $DBPW === $P
        focus-metavariable: $P
